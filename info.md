# Domonap Home Assistant Integration

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º–∏ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é **Domonap** (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–æ–º–æ—Ñ–æ–Ω–∞ –≤ –¥–æ–º–∞—Ö –ü–ò–ö) –∏–∑ **Home Assistant**.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –û—Ç–∫—Ä—ã—Ç–∏–µ –¥–≤–µ—Ä–µ–π  
* –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞  
* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–≤–æ–Ω–∫–∞—Ö –≤ –≤–∏–¥–µ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —Å–µ–Ω—Å–æ—Ä–∞  
* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –≤ —á–∞—Ç–µ 
* –°–æ–±—ã—Ç–∏—è –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è—Ö  

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è—Ö Home Assistant:
1. –ü—Ä–∏ –≤—Ö–æ–¥—è—â–µ–º –∑–≤–æ–Ω–∫–µ```domonap_incoming_call``` —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:
```yaml
event_type: domonap_incoming_call
data:
  EventMessage: DomofonCalling
  DoorId: 8452d508564e5a076c8122b6
  Address: –õ–∏—Ñ—Ç–æ–≤–æ–π —Ö–æ–ª–ª
  CallId: "154543486.54786447"
  VideoUrl: https://hls.domonap.ru/8452d508564e5a076c8122b6/index.m3u8
  HttpVideoUrl: https://hls.domonap.ru/8452d508564e5a076c8122b6/index.m3u8
  VideoPreview: >-
    https://api.domonap.ru/video-api/preview/Device/8452d508564e5a076c8122b6/qQtfsMiQYS0YuD8LLKrDGbPijncAShubrISKMs7E1cw
  SipAccount: "1000457231"
  SipPassword: 8452d508564e5a076c8122b6
  SipDomain: asterisk-2.domonap.ru
  SipPort: "7021"
  PushType: Domofon
  photoUrl: https://s3-api.domonap.ru/snapshot/154543486.54786447
origin: LOCAL
time_fired: "2025-06-18T15:10:58.919425+00:00"
```
* `DoorId` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–≤–µ—Ä–∏
* `Address` - –∞–¥—Ä–µ—Å –≤—ã–∑—ã–≤–∞—é—â–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ 
* `PhotoUrl` - URL —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∑–≤–æ–Ω—è—â–µ–≥–æ

2. –ü—Ä–∏ –≤—Ö–æ–¥—è—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏```domonap_receive_message``` —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:
```yaml
event_type: domonap_receive_message
data:
  id: 8452d508564e5a076c8122b6
  channel: username1-username
  text: "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
  data: null
  sender: username1
  name: Username
  chatType: Private
  createdOn: "2025-06-18T15:02:32.1264693Z"
  isRead: false
  avatar: https://s3-api.domonap.ru/avatar/avatar
origin: LOCAL
time_fired: "2025-06-18T15:02:32.208782+00:00"
```

3. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∂–∏—Ç–µ–ª—è –¥–æ–º–∞)```domonap_user_status_changed``` —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:
```yaml
event_type: domonap_user_status_changed
data:
  user: username1
  status: offline
origin: LOCAL
time_fired: "2025-06-18T15:07:23.395167+00:00"
```

### –ü—Ä–∏–º–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–π:
Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Home Assistant:
```yaml
automation:
  - alias: "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–≤–æ–Ω–∫–µ"
    trigger:
      platform: event
      event_type: domonap_incoming_call
    action:
      - service: notify.mobile_app
        data:
          message: "–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ –Ω–∞ –¥–æ–º–æ—Ñ–æ–Ω"
          data:
            image: "{{ trigger.event.data.PhotoUrl }}"
```
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–≤–æ–Ω–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–µ–º —Å —Ñ–æ—Ç–æ –≤ Telegram (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ [Telegram](https://www.home-assistant.io/integrations/telegram_polling)):
```yaml
automation:
  - alias: "–ó–≤–æ–Ω–æ–∫ –∏–∑ –¥–æ–º–æ—Ñ–æ–Ω–∞ –≤ Telegram"
    triggers:
      - trigger: event
        event_type: domonap_incoming_call
    actions:
      - action: telegram_bot.send_photo
        data:
          caption: |-
            üìûüì≤ –ö—Ç–æ-—Ç–æ –∑–≤–æ–Ω–∏—Ç –≤ –¥–æ–º–æ—Ñ–æ–Ω
            üìå {{ trigger.event.data.Address }} 
          url: "{{ trigger.event.data.PhotoUrl }}"
          inline_keyboard: "üîì –û—Ç–∫—Ä—ã—Ç—å:/open_{{ trigger.event.data.DoorId }}"
```
## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
–°—É—â–µ—Å—Ç–≤—É–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Domonap –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ HA. –ù–∞ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º Domonap –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—Ö–æ–¥—è—â–µ–º –∑–≤–æ–Ω–∫–µ –≤ —Ä–µ–∂–∏–º–µ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–æ–º —ç–∫—Ä–∞–Ω–µ. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å —ç—Ç–æ —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã "–ø—Ä–æ–ª–µ—á–µ–Ω–∞" –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–µ–∑ –∫–∞–∫–∏—Ö –ª–∏–±–æ –ø—Ä–æ–±–ª–µ–º.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

* –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä Home Assistant  
* –î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ —Ä–∞–∑–¥–µ–ª–µ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —Å–ª—É–∂–±—ã**  
* –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–º—É –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏  

## –û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

–î–∞–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –Ω–∏–∫–∞–∫ –Ω–µ —Å–≤—è–∑–∞–Ω–æ –∏ –Ω–µ –æ–¥–æ–±—Ä–µ–Ω–æ –û–û–û ¬´–î–û–ú–û–ù–ê–ü¬ª, –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —Ç–æ—Ä–≥–æ–≤–æ–π –º–∞—Ä–∫–∏ **–î–û–ú–û–ù–ê–ü**. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫. –ê–≤—Ç–æ—Ä –Ω–∏ –ø—Ä–∏ –∫–∞–∫–∏—Ö –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞—Ö –Ω–µ –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –∏–ª–∏ —É—Ç—Ä–∞—Ç—É –≤–∞—à–µ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞, –∞ —Ç–∞–∫–∂–µ –∑–∞ –≤–æ–∑–º–æ–∂–Ω—ã–π –≤—Ä–µ–¥ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º.  

–í—Å–µ –Ω–∞–∑–≤–∞–Ω–∏—è –±—Ä–µ–Ω–¥–æ–≤ –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –∏—Ö –∑–∞–∫–æ–Ω–Ω—ã–º –≤–ª–∞–¥–µ–ª—å—Ü–∞–º.